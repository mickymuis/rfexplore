{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4400b693a85e5d4284ae","webpack:///../index.js","webpack:///./rfexplore/rfexplore.js","webpack:///./rfexplore/automaton.js","webpack:///./rfexplore/viewport.js","webpack:///./rfexplore/value_equals.js","webpack:///./rfexplore/menubar.js"],"names":["UIController","viewport","autoUpdate","_viewmode","_palette","_automaton","_oldopts","_opts","mode","base","folds","rule","input","foldToRight","_listeners","maxrules","Array","setOnInputClicked","i","incrementInput","on","event","func","push","update","render","change","generate","automaton","console","log","viewmode","palette","JSON","parse","stringify","nextRule","previousRule","step","col","width","inputSize","delta","length","j","value","row","unshift","_emit","data","listeners","c","m","maxRules","b","App","container_id","container","document","getElementById","body","createElement","className","appendChild","init","controller","toolbox","setupToolbox","menubar","setupMenubar","a_ctrls","addGroup","floatLeft","addLink","step_ctrls","floatCenter","rule_label","addButton","action","r","text","r_ctrls","floatRight","screenfull","toggle","dat","GUI","f_a","addFolder","add","name","rule_ctrl","max","updateDisplay","listen","Left","Right","open","f_v","Brick","Diamond","Circle","Stack","Folded","f_c","addColor","onFinishChange","f_r","Rows","Ordered","Automaton","maxSteps","opts","_rows","slice","reverse","_curRow","_curPos","_folds","ttable","makeTTable","nodeCount","rowLength","rulesize","Math","pow","tt","decimal","floor","ttIndex","A","mult","index","first","_transpose","isLast","n","last","next","_next","previous","_previous","pos","error","nextPos","foldValue","len","fill","parents","done","_mirrored","_row","unfoldedRowLength","lastInputRow","diamondWidth","sqrt","Viewport","elem","viewportWidth","offsetWidth","viewportHeight","offsetHeight","_backgroundColor","_scene","_aspect","_cameraPersp","_cameraOrtho","_controls","_sceneHeight","_renderer","_lights","_raycaster","THREE","Raycaster","_mouse","Vector2","_model","geometry","attr_normal","buf_normal","attr_color","buf_color","attr_position","buf_position","offset","template_size","node_count","mesh","input_pickers","picked","right","_animation","spin","animateDraw","drawType","drawDone","node","_inputClickCallback","animate","req","_updateCellsAnimated","rotateY","requestAnimationFrame","Scene","background","Color","backgroundColor","PerspectiveCamera","OrthographicCamera","WebGLRenderer","antialias","setSize","domElement","position","z","OrbitControls","addEventListener","lights","AmbientLight","set","target","Vector3","DirectionalLight","window","_onWindowResize","e","_onDocumentMousemove","_onClick","updateCamera","sceneHeight","aspect","tan","fov","PI","updateProjectionMatrix","left","top","bottom","clearGeometry","scene","children","remove","populate","_updateGeometry","_updateCells","x","clientX","innerWidth","y","clientY","innerHeight","setFromCamera","intersects","intersectObjects","material","opacity","object","userData","_setColor","color","M","g","updateRange","count","old_offset","_nodeColor","_calcNodeOffset","rowoffs","only_clean","rows","needsUpdate","dispose","template","MeshBasicMaterial","side","DoubleSide","vertexColors","VertexColors","PlaneBufferGeometry","toNonIndexed","rotateZ","scale","CircleBufferGeometry","BufferGeometry","positions","Float32Array","cos","sin","addAttribute","BufferAttribute","getAttribute","array","MeshStandardMaterial","metalness","SphereBufferGeometry","array_size","Uint8Array","Int16Array","addInstance","translate","normals","foldedPosition","inputLength","noY","coneRow","coneCol","fold","coneRowWidth","calcPosition","p","phi","fold_offset","radius","heightstep","ps","t","tri","clone","picker_material","transparent","picker_mesh","Mesh","normalized","computeBoundingSphere","controls","reset","enableRotate","str","equals","a","enforce_properties_order","cyclic","_equals","s","l","toString","call","valueOf","source","global","ignoreCase","multiline","lastIndex","reference_equals","properties","hasOwnProperty","object_references","_reference_equals","TEXT_TYPE","BUTTON_TYPE","NO_ACTION","FUNC_ACTION","URL_ACTION","DROPDOWN_ACTION","Menuitem","iconclass","type","_text","_iconclass","_type","_action","_callback","_liNode","_aNode","_textNode","_iconNode","_appendElem","obj","setAttribute","createTextNode","_clicked","nodeValue","Menubar","subgroup","parent","panel","parentContainer","_subgroup","_parent","_rootPanel","_ulNode","_items","_groups","group","addPanel","item"],"mappings":"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","file":"rfexplore.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rfexplore\"] = factory();\n\telse\n\t\troot[\"rfexplore\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4400b693a85e5d4284ae","import rfexplore from './src/rfexplore/rfexplore.js';\n\nexport default rfexplore;\n\n\n\n// WEBPACK FOOTER //\n// ../index.js","import Automaton from \"./automaton.js\";\nimport Viewport from \"./viewport.js\";\nimport Menubar from \"./menubar.js\";\nimport equals from \"./value_equals.js\";\n\nclass UIController {\n    constructor( viewport ) {\n        this.viewport =viewport;\n        this.autoUpdate =true;\n        this._viewmode ='circle';\n        this._palette = [ '#ff5511', '#33ffcc', '#ffaa33', '#5E69FF' ]; \n        this._automaton =null;\n        this._oldopts = null;\n        this._opts = { // Options to Automaton constructor\n            mode: 2,\n            base: 2,\n            folds: 0,\n            rule: 6,\n            input: [ 0, 1, 1, 0, 0, 1, 0 ],\n            foldToRight: false\n        }; \n        this._listeners = {\n            maxrules: new Array(),\n            rule: new Array(),\n            folds: new Array()\n        };\n\n        viewport.setOnInputClicked( (i)=>{this.incrementInput(i);} );\n    }\n\n    on( event, func ) {\n        if( typeof func === 'function' \n            && typeof this._listeners[event] !== 'undefined' ) {\n            this._listeners[event].push( func );\n        }\n    }\n\n    update() {\n        if( this.autoUpdate )\n            this.render();\n    }\n    render() {\n\n        let change =false;\n\n        if( !equals( this._oldopts, this._opts ) || this._automaton === null ) {\n            this._automaton = new Automaton( this._opts );\n            this._automaton.generate();\n            this.viewport.automaton = this._automaton;\n            change =true;\n        }\n        else console.log( 'not changed' );\n\n        if( this._viewmode != this.viewport.viewmode ) {\n            this.viewport.viewmode = this._viewmode;\n            change =true;\n        }\n        \n        if( !equals( this._palette, this.viewport.palette ) ) {\n            this.viewport.palette =this._palette;\n            change =true;\n        }\n\n        if( change ) {\n            this.viewport.update();\n        }\n\n        // Caching\n        this._oldopts =JSON.parse( JSON.stringify( this._opts ) );\n    }\n\n    nextRule() {\n        this.rule++;\n    }\n\n    previousRule() {\n        this.rule--;\n    }\n\n    step() {\n        if( this._automaton === null )\n            render();\n\n        this._automaton.step();\n        this.viewport.update();\n    }\n\n    incrementInput( col ) {\n        let automaton = this._automaton;\n        if( col >= automaton.width )\n            return;\n        // If the automaton is left-folding, the input is on the right hand side\n        let i = this._opts.foldToRight ? col : col - (automaton.width - automaton.inputSize)\n        let input = this._opts.input;\n\n        // We may need to expand the input array using values from the automaton\n        let delta =0;\n        if( i >= input.length ) {\n            for( let j = input.length; j <= i; j++ ) {\n                input[j] = automaton.value( { col: j, row: 0 } );\n                delta++;\n            }\n        } else if( i < 0 ) {\n            for( let j = automaton.width - automaton.inputSize - 1; j >= col; j-- ) {\n                input.unshift( automaton.value( { col: j, row: 0 } ) );\n                delta++;\n            }\n            i =0;\n        }\n        this._opts.folds -= this._opts.folds === 0 ? 0 : delta;\n        input[i] = (input[i] === (this._opts.base - 1)) ? 0 : input[i]+1;\n//        console.log( 'picked input ' + i + \" new array\" + input );\n        this.render();\n    }\n\n    // Properties\n    get color0()        { return this._palette[0]; }\n    set color0(c)       { this._palette[0] =c; this.update(); }\n    get color1()        { return this._palette[1]; }\n    set color1(c)       { this._palette[1] =c; this.update(); }\n    get color2()        { return this._palette[2]; }\n    set color2(c)       { this._palette[2] =c; this.update(); }\n    get color3()        { return this._palette[3]; }\n    set color3(c)       { this._palette[3] =c; this.update(); }\n\n    get viewmode()      { return this._viewmode; }\n    set viewmode(m)     { this._viewmode =m;  this.update(); }\n    get mode()          { return this._opts.mode; }\n    set mode(i)         { \n        this._opts.mode =i; \n        this._emit( 'maxrules', Automaton.maxRules( this._opts.base, i ) ); \n        this.update(); \n    }\n    get base()          { return this._opts.base; }\n    set base(i)         { \n        this._opts.base =i; \n        this._emit( 'maxrules', Automaton.maxRules( i, this._opts.mode ) ); \n        this.update(); \n    }\n    get folds()         { return this._opts.folds; }\n    set folds(i)        { this._opts.folds =i; this._emit( 'folds', i ); this.update(); }\n    get foldToRight()   { return this._opts.foldToRight; }\n    set foldToRight(b)  { this._opts.foldToRight =(b == 'true' || b == true); this.update(); }\n    get rule()          { return this._opts.rule; }\n    set rule(i)         { \n        if( i >= 0 && i < this._automaton.maxRules ) { \n            this._opts.rule =i; \n            this._emit( 'rule', i );\n            this.update(); \n        } \n    }\n\n    get inputSize()     { return this._opts.input.length; }\n    set inputSize(i)    { }\n\n    _emit( event, data ) {\n        let listeners = this._listeners[event];\n        if( typeof listeners === 'undefined' )\n            return;\n        for( const func of listeners )\n            func( data );\n    }\n}\n\nclass App {\n    constructor( { container_id = '' } ) {\n        console.log( 'hallo ik ben een poes, dag vrienden' );\n\n        // Create a viewport container inside the given element id\n        this.container =document.getElementById( container_id );\n        if( typeof this.container == 'undefined' )\n            this.container =document.body;\n\n        let viewport = document.createElement( 'div' )\n            viewport.className = 'viewport';\n        this.container.appendChild( viewport );\n\n        // Let's set-up the viewport\n        this.viewport = new Viewport( viewport );\n        this.viewport.init();\n\n        // Create the controller for the user controls\n        this.controller = new UIController( this.viewport );\n\n        // Set-up UI\n        this.toolbox =null;\n        this.setupToolbox();\n        this.menubar =null;\n        this.setupMenubar();\n\n        // Render initial settings\n        this.controller.render();\n\n        /*let a = this.controller._automaton;\n        let n = a.first();\n        do {\n            console.log( `Node: ${n.row},${n.col}` );\n            n = a.next(n);\n        } while( a.isLast(n) );*/\n    }\n    setupMenubar() {\n        // Make a menubar \n        this.menubar = new Menubar( this.container );\n        \n        let a_ctrls = this.menubar.addGroup().floatLeft(); \n        a_ctrls.addLink( 'RFExplore' );\n\n        let step_ctrls = this.menubar.addGroup().floatCenter();\n        let rule_label =null;\n        step_ctrls.addButton( '', 'fa fa-backward' ).action( ()=> { this.controller.previousRule(); } );\n        rule_label = step_ctrls.addLink( 'Rule #' + this.controller.rule );\n        this.controller.on( 'rule', (r)=> { rule_label.text = 'Rule #' + r; } );\n        step_ctrls.addButton( '', 'fa fa-forward' ).action( ()=> { this.controller.nextRule(); } );\n\n        let r_ctrls = this.menubar.addGroup().floatRight();\n        r_ctrls.addButton( '', 'fa fa-arrows-alt' ).action( ()=>{ screenfull.toggle(); } );\n        r_ctrls.addButton( '', 'fa fa-step-forward' ).action( ()=>{ this.controller.step(); } );\n        r_ctrls.addButton( 'Render', 'fa fa-camera-retro' ).action( ()=>{ this.controller.render(); } );\n        r_ctrls.addLink( '', 'fa fa-circle-o' );\n\n    }\n    setupToolbox() {\n        this.toolbox = new dat.GUI();\n\n        // Automaton toolbox\n        let f_a = this.toolbox.addFolder( 'Automaton' );\n        f_a.add( this.controller, 'mode', 2, 2 ).step(1).name( 'Mode' );\n        f_a.add( this.controller, 'base', 2, 4 ).step(1).name( 'Base' );\n        let rule_ctrl = f_a.add( this.controller, 'rule', 0, 15 ).name( 'Rule' ).step(1);\n        this.controller.on( 'maxrules', (i)=>{ rule_ctrl.max(i); rule_ctrl.updateDisplay() } );\n        this.controller.on( 'rule' , (i)=>{ rule_ctrl.updateDisplay(); } );\n        f_a.add( this.controller, 'folds', 0, 500 ).name( '#Folds' ).step(1).listen();\n        f_a.add( this.controller, 'foldToRight', { Left: false, Right: true } ).name( 'Fold' );\n        f_a.add( this.controller, 'inputSize').name( 'Input size' ).step(1).listen();\n        f_a.open();\n\n        // Visualisation toolbox\n        let f_v = this.toolbox.addFolder( 'Visualisation' );\n        f_v.add( this.controller, 'viewmode', { Brick : 'brick', Diamond: 'diamond', Circle: 'circle', Stack: 'stack', Folded: 'folded' } ).name( 'Cell shape' );\n        f_v.open();\n\n        // Colors toolbox\n        let f_c = this.toolbox.addFolder( 'Colors' );\n        f_c.addColor( this.controller, 'color0' ).name( '0' ).onFinishChange( () => { this.controller.update(); } ) ;\n        f_c.addColor( this.controller, 'color1' ).name( '1' );\n        f_c.addColor( this.controller, 'color2' ).name( '2' );\n        f_c.addColor( this.controller, 'color3' ).name( '3' );\n        f_c.addColor( this.viewport, 'backgroundColor' ).name( 'Background' );\n        //f_c.open();\n\n        // Render toolbox\n        let f_r = this.toolbox.addFolder( 'Render' );\n        f_r.add( this.controller, 'autoUpdate' ).name( 'Auto-update' );\n        f_r.add( this.viewport, 'animateSpin' ).name( 'Spin' );\n        f_r.add( this.viewport, 'animateDraw' ).name( 'Animate draw' );\n        f_r.add( this.viewport, 'animateDrawType', { Rows: 'rows', Ordered: 'ordered' } ).name( 'Draw type' );\n        f_r.add( this.controller, 'render' ).name( 'Render' );\n    }\n}\n\nexport default {\n    App : App\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./rfexplore/rfexplore.js","\"use strict\";\n\nexport default class Automaton {\n\n/* \n * Constructs a new Automaton given 'opts' and generates a transition table \n */\n    constructor( \n        {\n            base = 2,\n            mode = 2,\n            rule = 0,\n            input = [ 0, 0],\n            maxSteps = 0,\n            folds = 0,\n            foldToRight = false\n        } = {}\n    ) {\n        this.opts = {\n            base: base,\n            mode: mode,\n            rule: rule,\n            input: input,\n            maxSteps: maxSteps,\n            folds: folds,\n            foldToRight: foldToRight\n        };\n/*        this._= {\n            curRow : 1, // row 0 is the top (input) row\n            curPos : ( foldToRight ? this._rows[0].length-2 : 0 ),\n            folds: 0\n        };*/\n        // Internal state\n        this._rows = new Array();\n        this._rows.push( foldToRight? input.slice() : input.slice().reverse() );\n        this._curRow = 0; // row 0 is the top (input) row\n        this._curPos = this._rows[0].length -1;\n        this._folds  = 0;\n       \n        this.maxRules =0;\n        this.ttable = this.makeTTable( base, mode, rule );\n        this.nodeCount = this.width;\n        this.inputSize = input.length;\n\n    }\n\n    /* \n     * General functions that define the dimensions \n     */\n    get width() {\n        return this._rows[0].length;\n    }\n\n    get rows() {\n        return this._rows.length;\n    }\n\n    rowLength( i ) {\n        return this._rows[i].length;\n    }\n\n    static maxRules( base, mode ) {\n        let rulesize = Math.pow( base, mode );\n        return  Math.pow( base, rulesize );\n    }\n\n    /*\n     * Generate a transition table given a base, mode and rule number\n     * Returns an array\n     */\n    makeTTable( base, mode, rule ) {\n        var tt = new Array();\n        let rulesize = Math.pow( base, mode );\n        this.maxRules = Math.pow( base, rulesize );\n\n        console.log( \"Transition table for rule #\" + rule + \" / \" + this.maxRules + \" * \" + rulesize );\n        if( rulesize > this.maxRules ) {\n            return null;\n        }\n\n        for( let i = 0; i < rulesize; i++ )\n            tt[i] = 0;\n\n        let decimal = rule; // Rule in base 10\n        let i = rulesize -1;\n        while( i >= 0 && decimal > 0 ) {\n            tt[i] = decimal % base;\n            decimal = Math.floor( decimal / base );\n            i--;\n        }\n        for( let i = 0; i < rulesize; i++ )\n            console.log( i + \": \" + tt[i] );\n        return tt;\n    }\n\n    /*\n     * Given a base, mode and set of input nodes A (A.length == mode),\n     * returns the index of the transition table that contains the reduction rule\n     * for A[0] .. A[mode-1] -> b\n     */\n    ttIndex( base, mode, A ) {\n        let mult =1;\n        let index =0;\n        for( let i = mode-1; i >= 0; i-- ) {\n            index += A[i] * mult;\n            mult *= base;\n        }\n        return index;\n    }\n\n    first() {\n        return this._transpose( { col: 0, row: 0 } );\n    }\n\n    isLast( {col, row} ) {\n        let n = this._transpose( { col: col, row: row } );\n        return (n.col === this._curPos && n.row === this._curRow);\n    }\n\n    /*\n     * Return the position { col, row } of the most recently calculated node\n     */\n    last() {\n        return this._transpose( { col: this._curPos, row: this._curRow } );\n    }\n\n    /*\n     * Given a column and row, return the position of the next node that need to be calculated\n     * Returns object in the form of { col, row }\n     */\n    next( { col, row }  ) {\n        return this._transpose( this._next( this._transpose( { col: col, row: row } ) ) );\n    }\n\n    /*\n     * Given a column and row, return the position of the previously calculated node\n     * Returns object in the form of { col, row }\n     */\n    previous( { col, row } ) {\n        return this._transpose( this._previous( this._transpose( { col: col, row: row } ) ) ); \n    }\n\n    /* Given a column and row, return the value of the node in that position\n     * Note that a bounds check is omitted for performance\n     */\n    value( { col, row } ) {\n        let pos = this._transpose( { col: col, row: row } );\n        return this._rows[pos.row][pos.col];\n    }\n\n    /*\n     * Advance the automaton by one step\n     * This step may either be a reduction step or a fold\n     */\n    step() { \n        if( this._curRow === 0 && this._rows.length === 0 ) {\n            console.error( \"Automaton: undefined top row, there is no input.\" );\n            return;\n        }\n        // Step 0. compute the position of the next cell\n        let nextPos = this._next( { col: this._curPos, row: this._curRow } );\n        this._curRow = nextPos.row;\n        this._curPos = nextPos.col;\n\n        if( this._curRow === 0 ) {\n            //console.log( \"fold\" );\n            // Top row, which means the next step can only be a fold\n            // Step 1. extend all rows by one\n            for( let i =0; i < this._rows.length; i++ ) {\n                // push\n                this._rows[i][this._rows[i].length] = -1;\n            }\n            // Step 2. copy ('fold') the apex/singleton row over to the top row\n            let foldValue = this._rows[this._rows.length-1][0];\n            this._rows[0][this._curPos] = foldValue;\n            // Step 3. extend the automata\n            this._rows.push( [-1] );\n            this._folds++;\n            this.nodeCount += this._rows.length;\n            return;\n        }\n        else if( typeof this._rows[this._curRow] === 'undefined' ) {\n            // We need to start a new row\n            let len = this._rows[this._curRow-1].length - 1;\n            this._rows.push( new Array(len) );\n            this._rows[this._curRow].fill( -1 );\n            this.nodeCount += len;\n        }\n        // Now we calculate the next iteration by reduction\n        // Step 1. get values from parent nodes (one row up)\n        let parents = this._rows[this._curRow-1].slice( this._curPos, this._curPos + this.opts.mode );\n\n        // Step 2. Use the transition table to obtain the value for the current node\n        var value =this.ttable[this.ttIndex( this.opts.base, this.opts.mode, parents )];\n        this._rows[this._curRow][this._curPos] = value;\n\n    }\n\n    generate( done ) {\n        \n        while( this._rows[this._curRow].length !== 1\n               || this._folds !== this.opts.folds ) {\n            this.step();\n        }\n\n\n        if( typeof done  === 'function' )\n            done( this );\n    }\n\n    /*\n     * If the automaton is set to expand (fold) to the left, \n     * we mirror the entire datastructure for optimization.\n     */\n    _mirrored() {\n        return !this.opts.foldToRight;\n    }\n\n    /*\n     * Return the transposed (mirrored) coordinates for {col,row}\n     * This translates internal coordinates to logical (abstracted) coordinates\n     */\n    _transpose( { col, row } ) {\n\n        if( this.opts.foldToRight )\n            return { col: col, row: row };\n        else\n            return { col: (this._rows[row].length-1) - col, row: row };\n    }\n\n    /*\n     * Calculate the next position using internal coordinates\n     */\n    _next( { col, row } ) {\n        let _row = this._rows[row];\n        let unfoldedRowLength = this.inputSize - row * (this.opts.mode-1);\n        let lastInputRow = this.inputSize-1; // TODO fix for mode > 2\n\n        if( col < unfoldedRowLength && row < lastInputRow ) {\n            if( col === unfoldedRowLength - 1 )\n                return { col: 0, row: row + 1 };\n            else\n                return { col: col + 1, row: row };\n        }\n        else if( col === 0 ) {\n            return { col: this.inputSize + (row - lastInputRow), row: 0 };\n        } \n\n        return { col: col - 1, row: row + 1 };\n\n\n       /* // Case 1: we're the apex, return to the top row\n        if( _row.length === 1 ) {\n            return { col: this._rows[0].length, row: 0 };\n        }\n        // Case 2: end of the row, advance one row\n        else if( col+1 >= _row.length ) {\n            if( row+1 < this.rows ) {\n                let _row = this._rows[row+1];\n                // Case 2a: We're folding, only one value missing\n                if( typeof _row !== 'undefined'  && _row[0] !== -1 )\n                    return { col: _row.length-1, row: row + 1 };\n            }\n            // Case 2b: Not folding, start at the beginning\n            return { col: 0, row: row + 1 };\n        }\n        // Case 3: next column is already calculated, advance one row\n        //else if( _row[col+1] !== -1 ) {\n        //    return { col: 0, row: row + 1 };\n        //}\n        // Case 4: just advance the column\n        return { col: col + 1, row: row };*/\n    }\n\n    /*\n     * Calculate the previous position using internal coordinates\n     */\n    _previous( { col, row } ) {\n        let pos = { col: col, row: row };\n        let _row = this._rows[row];\n    }\n\n} // class Automaton\n\n\n\n// WEBPACK FOOTER //\n// ./rfexplore/automaton.js","\n\"use strict\";\nimport equals from \"./value_equals.js\";\n\nconst diamondWidth = 1 * Math.sqrt( 2 );\n\nexport default class Viewport {\n    constructor( elem ) {\n\n        this.container =elem;\n        \n        this.automaton = null;\n        // fixme: remove\n        this.palette = [ '#ff5511', '#33eeff', '#ff33dd' ];\n\n        this.viewportWidth = this.container.offsetWidth;\n        this.viewportHeight = this.container.offsetHeight;\n\n        this._viewmode = 'folded'; // one of 'brick', 'diamond', 'circle', 'folded'\n        this._backgroundColor = '#777777'\n        this._scene = null;\n        this._aspect =1.0;\n        this._cameraPersp = null;\n        this._cameraOrtho = null;\n        this._controls = null;\n        this._sceneHeight = 10;\n        this._renderer = null;\n        this._lights = new Array();\n        this._raycaster = new THREE.Raycaster();\n        this._mouse = new THREE.Vector2();\n        this._model = { \n            geometry: null,     // BufferGeometry reference\n            attr_normal: null,  // BufferAttribute for normal\n            buf_normal: null,   // Int16Array with normals\n            attr_color: null,   // BufferAttribute for color\n            buf_color: null,    // Uint8Array with color data\n            attr_position: null,// BufferAttribute for position\n            buf_position: null, // Float32Array with position data\n            offset: 0,          // Pointer after the last element\n            template_size: 0,   // Elements in the template geometry\n            node_count: 0,      // Total number of nodes in the geometry\n            mesh: null,         // Mesh reference to the final object\n            viewmode: null,     // Viewmode used to construct geometry\n            mode: 0,            // Mode used to contruct geometry\n            input_pickers: null,// Array of Meshes \n            picked: null,       // Reference to the picked Mesh\n            right: false        // Pivot is at right hand side\n        };\n        this._animation = {\n            spin: true,\n            animateDraw: true,\n            drawType: 'rows', //  one of 'rows', 'ordered'\n            drawDone: false,\n            node: { col:0, row: 0 },\n            row: 0\n        };\n        this._inputClickCallback = null;\n    }\n\n    render() {\n        if( this._viewmode === 'folded' ) {\n            this._renderer.render( this._scene, this._cameraPersp );\n        } else {\n            this._renderer.render( this._scene, this._cameraOrtho );\n        }\n\n    }\n\n    animate() { \n        let req =false; // request new frame\n\n        if( !this._animation.drawDone ) {\n            this._updateCellsAnimated();\n            req =true;\n        }\n        if( this._animation.spin && this._viewmode === 'folded' ) {\n            this._model.mesh.rotateY( 0.002 );\n            req =true;\n        }\n\n        this._controls.update();\n        this.render();\n        \n        if( req ) \n            requestAnimationFrame( ()=>{this.animate()} );\n    }\n\n    init() {\n        console.log( 'Initializing WebGL' );\n  \n        this._scene = new THREE.Scene();\n        this._scene.background = new THREE.Color( this.backgroundColor );\n        this._aspect = this.viewportWidth / this.viewportHeight;\n        this._cameraPersp = new THREE.PerspectiveCamera( 35, this._aspect, 0.1, 3000 );\n        this._cameraOrtho = new THREE.OrthographicCamera( \n                this._aspect * this._sceneHeight / -2, \n                this._aspect * this._sceneHeight / 2, \n                -this._sceneHeight / 2, this._sceneHeight / 2 );\n        \n        this._renderer = new THREE.WebGLRenderer( {antialias:true} );\n        this._renderer.setSize( this.viewportWidth, this.viewportHeight );\n        this.container.appendChild( this._renderer.domElement );\n\n        this._cameraOrtho.position.z = 10;\n        this._cameraPersp.position.z = 10;\n\n        // Setup orbit controls\n        this._controls = new THREE.OrbitControls( this._cameraPersp, this._renderer.domElement );\n        this._controls.addEventListener( 'change', () => { this.render(); } );\n\n        // Setup lights for the 3d view\n        let lights = this._lights;\n        lights[0] = new THREE.AmbientLight( 0x13162B, 4 );\n        lights[0].position.set( 0, 0, 0 );\n        lights[0].target = new THREE.Vector3( 0, 0, 0 );\n        this._scene.add( lights[0] );\n        \n        lights[1] = new THREE.DirectionalLight( 0xEDE2C7 );\n        lights[1].position.set( 10, 10, 10 );\n        this._scene.add( lights[1] );\n        \n        lights[2] = new THREE.DirectionalLight( 0xC7E8ED );\n        lights[2].position.set( 0, -10, -10 );\n        this._scene.add( lights[2] );\n        \n        lights[3] = new THREE.DirectionalLight( 0xC8D9C8 );\n        lights[3].position.set( -10, 10, 0 );\n        this._scene.add( lights[3] );\n        \n        this.render();\n\n        window.addEventListener( 'resize', () => { this._onWindowResize(); } );\n        document.addEventListener( 'mousemove', (e) => { this._onDocumentMousemove(e); } );\n        this.container.addEventListener( 'click', () => { this._onClick(); } );\n\n    }\n\n    updateCamera() {\n        let sceneHeight = this._sceneHeight;\n        let aspect = this._aspect;\n        this._cameraPersp.aspect = aspect;\n        this._cameraPersp.position.z = 1.2\n            * (sceneHeight / 2 ) \n            / Math.tan( this._cameraPersp.fov / 360 * Math.PI );\n        this._cameraPersp.updateProjectionMatrix();\n        this._cameraOrtho.left = aspect * sceneHeight / -2;\n        this._cameraOrtho.right = aspect * sceneHeight / 2;\n        this._cameraOrtho.top = sceneHeight / 2;\n        this._cameraOrtho.bottom = sceneHeight / -2;\n        this._cameraOrtho.updateProjectionMatrix();\n\n    }\n\n    set viewmode( m ) {\n        let viewmode = this._viewmode;\n        let controls = this._controls;\n\n        if( viewmode === 'folded' && m !== 'folded' ) {\n            controls.reset();\n            controls.object = this._cameraOrtho;\n            controls.enableRotate =false;\n        } else if ( viewmode !== 'folded' && m === 'folded' ) {\n            controls.reset();\n            controls.object = this._cameraPersp;\n            controls.enableRotate = true;\n        }\n        this._viewmode =m;\n        //this.updateGeometry();\n\n    }\n\n    set animateDrawType( t ) { this._animation.drawType = t;  }\n    get animateDrawType() { return this._animation.drawType; }\n\n    set animateSpin( b ) { this._animation.spin = b; if( b ) this.animate(); }\n    get animateSpin() { return this._animation.spin; }\n\n    set animateDraw( b ) { this._animation.animateDraw =b; }\n    get animateDraw() { return this._animation.animateDraw; }\n    \n    set backgroundColor( str ) {\n        this._backgroundColor = str;\n        this._scene.background = new THREE.Color( this.backgroundColor );\n        this.render();\n    }\n    get backgroundColor() { return this._backgroundColor; }\n\n    setOnInputClicked( func ) {\n        this._inputClickCallback = func;\n    }\n\n    clearGeometry() {\n        let scene =this._scene;\n        for(let i = 0; i < scene.children.length; i++){\n            if( scene.children[i].name !== 'helper' &&\n                    !(scene.children[i] instanceof THREE.AmbientLight) &&\n                    !(scene.children[i] instanceof THREE.DirectionalLight) ) {\n                scene.remove(scene.children[i]);\n                i--;\n            }\n        }\n    }\n\n    update() {\n        if( this.automaton === null )\n            return;\n        // See if we need to update the geometry at all, criteria are:\n        // - Different viewmode\n        // - More cells \n        // - Different mode\n        // - Pivot position\n        if( this._viewmode !== this._model.viewmode \n            || this.automaton.opts.mode !== this._model.mode\n            || this.automaton.nodeCount !== this._model.node_count \n            || (!this.automaton.opts.foldToRight) !== this._model.right ) {\n            console.log( 'Viewport: rebuilding geometry' );\n            let populate = !this._animation.animateDraw;\n            this._updateGeometry( populate );\n        }\n        else {\n            if( !this._animation.animateDraw )\n                this._updateCells();\n        }\n        if( this._animation.animateDraw ) {\n            this._updateCells( true );\n            this._animation.node = this.automaton.first(); this._animation.row =0;\n            this._animation.drawDone = false;\n        }\n        this.animate();\n    }\n    \n    //\n    // Private event listeners\n    //\n    \n    _onWindowResize() {\n        let container = this.container;\n\n        this.viewportWidth = container.offsetWidth;\n        this.viewportHeight = container.offsetHeight;\n        this._aspect = this.viewportWidth / this.viewportHeight;\n        this.updateCamera();\n        this._renderer.setSize( this.viewportWidth, this.viewportHeight );\n        this.render();\n    }\n\n    _onDocumentMousemove( event ) {\n        this._mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;\n        this._mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;\n\n        if( this.viewmode !== 'folded' ) {\n            let render =false;\n\n            this._raycaster.setFromCamera( this._mouse, this._cameraOrtho );\n            let intersects = this._raycaster.intersectObjects( this._model.input_pickers );\n\n            if( this._model.picked !== null ) {\n                this._model.picked.material.opacity = 0.0;\n                this._model.picked = null;\n                render =true;\n            }\n            if( intersects.length !== 0 ) {\n                intersects[0].object.material.opacity = 0.5;\n                this._model.picked = intersects[0].object;\n                render =true;\n            }\n            if( render )\n                this.render();\n        }\n    }\n\n    _onClick() {\n        let picked = this._model.picked;\n        if( picked !== null ) {\n            if( typeof this._inputClickCallback === 'function' ) {\n                this._inputClickCallback( picked.userData.col );\n            }\n        }\n    }\n\n    //\n    // Private functions\n    //\n    \n    \n    /*\n     * Set the geometry's color at position of node to color\n     */\n    _setColor( node, color ) {\n        let M = this._model;\n        let n = M.template_size; // elements per template geometry\n        let offset = node * n;\n        for( let i =0; i < n; i+=3 ) {\n            M.buf_color[offset+i] = color.r * 255;\n            M.buf_color[offset+i+1] = color.g * 255;\n            M.buf_color[offset+i+2] = color.b * 255;\n        }\n        if( M.attr_color.updateRange.count === -1 ) {\n            M.attr_color.updateRange.offset = offset;\n            M.attr_color.updateRange.count = n;\n        } else {\n            let old_offset = M.attr_color.updateRange.offset;\n            if( old_offset < offset ) {\n                M.attr_color.updateRange.count = (offset - old_offset) + n;\n            }\n            else {\n                M.attr_color.updateRange.offset = offset;\n                M.attr_color.updateRange.count = (old_offset - offset) + n;\n            }\n        }\n    }\n\n    /* \n     * Given a col and row, return the color that represents the value\n     * of this node in the automaton\n     */\n    _nodeColor( node ) {\n        let color = this.backgroundColor;\n        let value = this.automaton.value( node );\n        if( value >= 0 ) \n            color = this.palette[ value ];\n        return new THREE.Color( color );\n    }\n\n    /*\n     * Given a col and row, calculate the offset within the geometry\n     */\n    _calcNodeOffset( { col, row } ) {\n        // FIXME: add support for modes\n        let width = this.automaton.width;\n        let rowoffs =0;\n        for( let i =0; i < row; i++ )\n            rowoffs += (width--);\n        return rowoffs + col;\n    }\n\n    /*\n     * Change the colors of the geometry such that it represents the current automaton \n     */\n    _updateCells( only_clean = false ) {\n        const automaton =this.automaton;\n        if( automaton === null )\n            return;\n\n        let node =0;\n        if( !only_clean ) {\n            for( let i =0; i < automaton.rows; i++ ) {\n                for( let j =0; j < automaton.rowLength(i); j++ ) {\n                    let color = this._nodeColor( { row: i, col: j } );\n                    this._setColor( this._calcNodeOffset( { col: j, row: i } ), new THREE.Color( color ) );\n\n                    node++;\n                }\n            }\n        }\n        // Make the rest of the cells blank\n        for( let n =node; n < this._model.node_count; n++ ) {\n            this._setColor( n, new THREE.Color( this.backgroundColor ) );\n        }\n        // Update the buffer\n        this._model.attr_color.needsUpdate =true;\n    }\n\n    /*\n     * Change the colors of the geometry such that it represents the current automaton,\n     * when animated, this function performs the next step in the animation.\n     */\n    _updateCellsAnimated() {\n        const automaton =this.automaton;\n        if( automaton === null )\n            return;\n\n        if( this._animation.drawType === 'ordered' ) {\n            let node = this._animation.node;\n            let color = this._nodeColor( node );\n            let offset = this._calcNodeOffset( node );\n\n            this._setColor( offset, color );\n            if( equals( node, automaton.last() ) )\n                this._animation.drawDone =true;\n            else\n                this._animation.node = automaton.next( node );\n        } else if( this._animation.drawType === 'rows' ) {\n            let row = this._animation.row;\n            for( let j =0; j < automaton.rowLength(row); j++ ) {\n                let node = { col: j, row: row };\n                let color = this._nodeColor( node );\n                let offset = this._calcNodeOffset( node );\n                this._setColor( offset, color );\n            }\n            if( row+1 === automaton.rows )\n                this._animation.drawDone =true;\n            else\n                this._animation.row++;\n        }\n\n        // Update the buffer\n        this._model.attr_color.needsUpdate =true;\n    }\n\n    /*\n     * Create a new geometry (mesh) based on the size of the automaton \n     * and the viewmode. Discards all previous geometry.\n     */\n    _updateGeometry( populate = true ) { \n        const automaton =this.automaton;\n        if( automaton === null )\n            return;\n        const viewmode =this._viewmode;\n\n        // Cleanup from previous calls\n        //\n        \n        let M = this._model;\n        if( M.geometry !== null ) {\n            this._scene.remove( M.mesh );\n           /* M.attr_position.setArray(null);\n            M.attr_normal.setArray(null);\n            M.attr_color.setArray(null);*/\n            M.geometry.dispose();\n            for( let i =0; i < M.input_pickers.length; i++ ) {\n                this._scene.remove( M.input_pickers[i] );\n            }\n            \n        }\n        M.input_pickers = new Array();\n        \n        // For some viewmode we use a template geometry\n        // Here we prepare this geometry and the material\n\n        let template =null;\n        let material =null;\n        \n        M.template_size =0;\n        if( viewmode !== 'folded' ) {\n            material = new THREE.MeshBasicMaterial( {side: THREE.DoubleSide, vertexColors: THREE.VertexColors} );\n            if( viewmode === 'brick' ) {\n                template = new THREE.PlaneBufferGeometry( 1, 1 );\n                template = template.toNonIndexed();\n            } \n            else if ( viewmode === 'diamond' ) {\n                template = new THREE.PlaneBufferGeometry( 1, 1 );\n                template.rotateZ( Math.PI * 0.25 );\n                template.scale( 1 / diamondWidth, 1 , 1 );\n                template = template.toNonIndexed();\n            } \n            else if( viewmode === 'circle' ) {\n                template = new THREE.CircleBufferGeometry( 0.5, 32 );\n                template = template.toNonIndexed();\n            } else if( viewmode === 'stack' ) {\n                template = new THREE.BufferGeometry();\n                let positions = new Float32Array( [\n                        Math.cos( 2/3 * Math.PI ), 0.0, Math.sin( 2/3 * Math.PI ),\n                        Math.cos( 4/3 * Math.PI ), 0.0, Math.sin( 4/3 * Math.PI ),\n                        Math.cos( 0 ), 0.0, Math.sin( 0 ) ] );\n       /*         let normals = new Float32Array( [\n                        0.0, 0.0, 1.0,\n                        0.0, 0.0, 1.0,\n                        0.0, 0.0, 1.0 ] );*/\n                template.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\n            }\n\n            M.template_size = template.getAttribute( 'position' ).array.length; \n        }\n        else {\n            material = new THREE.MeshStandardMaterial( {side: THREE.DoubleSide, vertexColors: THREE.VertexColors, metalness: 0 } );\n            template = new THREE.SphereBufferGeometry( 1.0, 8, 8 );\n            template = template.toNonIndexed();\n            M.template_size = template.getAttribute( 'position' ).array.length; \n        }\n\n\n        // Prepare buffers for the geometry\n\n        M.geometry = new THREE.BufferGeometry();\n        let array_size = automaton.nodeCount * M.template_size; \n        M.buf_position = new Float32Array( array_size );\n        M.buf_color = new Uint8Array( array_size );\n        M.buf_normal = new Int16Array( array_size );\n        M.offset =0;\n        M.node_count = automaton.nodeCount;\n        M.right = !automaton.opts.foldToRight; // Position of the pivot\n\n        let addInstance = function( color, translate ) {\n            let positions = template.getAttribute( 'position' ).array;\n            let normals = null;\n            if( viewmode === 'folded' )\n                normals = template.getAttribute( 'normal' ).array;\n            for( let i =0; i < M.template_size; i+=3 ) {\n                M.buf_position[M.offset+i] = positions[i] + translate.x;\n                M.buf_position[M.offset+i+1] = positions[i+1] + translate.y;\n                M.buf_position[M.offset+i+2] = positions[i+2] + translate.z;\n\n                M.buf_color[M.offset+i] = color.r * 255;\n                M.buf_color[M.offset+i+1] = color.g * 255;\n                M.buf_color[M.offset+i+2] = color.b * 255;\n                \n                if( viewmode === 'folded' ) {\n                    M.buf_normal[M.offset+i] = normals[i] * 32767;\n                    M.buf_normal[M.offset+i+1] = normals[i+1] * 32767;\n                    M.buf_normal[M.offset+i+2] = normals[i+2] * 32767;\n                }\n            }\n            M.offset += positions.length;\n        };\n\n        let foldedPosition = function( row, col, width, inputLength, right, mode, noY =false ) {\n            // The pivot position determines where the rows start\n            //let coneCol = right ? (width-1) - col : col;\n            // Map the `triangle row' onto the `diagonal row'\n            //let coneRow = row + coneCol;\n            let coneRow = right ? row + (width-1) - col : row + col;\n            let coneCol = right ? row : coneRow - col;\n            let fold =!(coneRow < inputLength);\n            let coneRowWidth = coneRow + (fold ? 0 : 1); // FIXME: support for mode > 2\n\n            // Calculate the position of the node on the `cone'\n            let calcPosition = function( offset ) {\n                let p = new THREE.Vector3( 0, 0, 0 );\n                let phi = (coneCol+offset) * (2 * Math.PI / (coneRowWidth));\n                let fold_offset = (coneCol+offset) / coneRowWidth;\n                let radius = (coneRowWidth + fold_offset) / Math.PI;\n\n                p.x = Math.cos( phi ) * radius;\n                p.z = Math.sin( phi ) * radius;\n\n                p.y = -coneRow*2 - ((fold && !noY) ? 2 * fold_offset : 0);\n                return p;\n            }\n            return new Array( calcPosition( 0 ), calcPosition( 1 ) );\n        }\n\n        let heightstep = 1.0;\n        if( automaton.opts.mode % 2 === 0 ) {\n            if( viewmode === 'diamond' )\n                heightstep = 1 / diamondWidth;\n            else if( viewmode === 'circle' ) \n                heightstep = 0.5 + Math.sqrt(0.125);\n        }\n\n        let position = new THREE.Vector3 ( \n                0, \n                (automaton.rows - 1) * heightstep / 2,\n                0 );\n        for( let i =0; i < automaton.rows; i++ ) {\n            for( let j =0; j < automaton.rowLength(i); j++ ) {\n                position.x = -automaton.width / 2 + 0.5 * i + j; \n                \n                let color =populate ? this._nodeColor( {row: i, col: j} ) : new THREE.Color( this.backgroundColor );\n                \n                if( viewmode === 'folded' ) {\n                    let p = foldedPosition( i, j, automaton.rowLength(i), automaton.opts.input.length, M.right, automaton.opts.mode, false )[0];\n                    p.y += automaton.width;\n                    addInstance( color, p );\n                }\n                else if( viewmode === 'stack' ) {\n                    let ps = foldedPosition( i, j, automaton.rowLength(i), automaton.opts.input.length, M.right, automaton.opts.mode, true );\n                    // swap y and z\n                    let t = ps[0].y;\n                    ps[0].y = ps[0].z;\n                    ps[0].z = t;\n                    t = ps[1].y;\n                    ps[1].y = ps[1].z;\n                    ps[1].z = t;\n                    // Use these positions to place the triangle\n                    let tri = template.getAttribute( 'position' ).array;\n                    tri[0] = 0.0;       tri[1] = 0.0;     tri[2] = ps[0].z;  // x y z\n                    tri[3] = ps[0].x;   tri[4] = ps[0].y; tri[5] = ps[0].z;  // x y z\n                    tri[6] = ps[1].x;   tri[7] = ps[1].y; tri[8] = ps[1].z;  // x y z\n                    addInstance( color, new THREE.Vector3( 0,0,0 )  );\n                }\n                else {\n                    // Add an instance to the main geometry\n                    addInstance( color, position );\n\n                    // If the node is an input node, also add a picking-mesh for user input\n                    if( i === 0 ) {\n                        let g = template.clone();\n                        g.translate( position.x, position.y, 1 );\n                        let picker_material = \n                            new THREE.MeshBasicMaterial( {side: THREE.DoubleSide, color: '#ffffff', transparent: true, opacity: 0.0 } );\n                        let picker_mesh = new THREE.Mesh( g, picker_material );\n                        \n                        picker_mesh.userData.col = j;\n                        this._scene.add( picker_mesh );                       \n                        M.input_pickers.push( picker_mesh );\n                    }\n                }\n            }\n            position.y -= heightstep;\n        }\n        M.attr_position =new THREE.BufferAttribute(M.buf_position, 3 );\n        M.attr_color    =new THREE.BufferAttribute(M.buf_color, 3 );\n        M.attr_color.normalized = true;\n        M.geometry.addAttribute('position', M.attr_position );\n        M.geometry.addAttribute('color', M.attr_color ) ;\n        if( viewmode === 'folded' ) {\n            M.attr_normal   =new THREE.BufferAttribute(M.buf_normal, 3 );\n            M.attr_normal.normalized = true;\n            M.geometry.addAttribute('normal', M.attr_normal );\n        }\n        M.geometry.computeBoundingSphere();\n\n        M.mesh = new THREE.Mesh( M.geometry, material );\n        this._scene.add( M.mesh );\n\n        M.viewmode = viewmode;\n        M.mode = automaton.opts.mode;\n\n        if( viewmode === 'folded' )\n            this._sceneHeight = automaton.width * 2;\n        else if( viewmode === 'stack' )\n            this._sceneHeight = automaton.width * 0.8;\n        else\n            this._sceneHeight = automaton.width * 1.1;\n        \n        this.updateCamera();\n\n    }\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./rfexplore/viewport.js","/*  value_equals.js\n    \n    The MIT License (MIT)\n    \n    Copyright (c) 2013-2017, Reactive Sets\n    \n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n    \n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n    \n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n/* Slightly modified version of https://github.com/ReactiveSets/toubkal/blob/master/lib/util/value_equals.js */\n\n/* -----------------------------------------------------------------------------------------\n equals( a, b [, enforce_properties_order, cyclic] )\n \n Returns true if a and b are deeply equal, false otherwise.\n \n Parameters:\n   - a (Any type): value to compare to b\n   - b (Any type): value compared to a\n \n Optional Parameters:\n   - enforce_properties_order (Boolean): true to check if Object properties are provided\n     in the same order between a and b\n   \n   - cyclic (Boolean): true to check for cycles in cyclic objects\n \n Implementation:\n   'a' is considered equal to 'b' if all scalar values in a and b are strictly equal as\n   compared with operator '===' except for these two special cases:\n     - 0 === -0 but are not equal.\n     - NaN is not === to itself but is equal.\n   \n   RegExp objects are considered equal if they have the same lastIndex, i.e. both regular\n   expressions have matched the same number of times.\n   \n   Functions must be identical, so that they have the same closure context.\n   \n   \"undefined\" is a valid value, including in Objects\n   \n   106 automated tests.\n   \n   Provide options for slower, less-common use cases:\n   \n     - Unless enforce_properties_order is true, if 'a' and 'b' are non-Array Objects, the\n       order of occurence of their attributes is considered irrelevant:\n         { a: 1, b: 2 } is considered equal to { b: 2, a: 1 }\n     \n     - Unless cyclic is true, Cyclic objects will throw:\n         RangeError: Maximum call stack size exceeded\n*/\nexport default function equals( a, b, enforce_properties_order, cyclic ) {\nreturn a === b       // strick equality should be enough unless zero\n  && a !== 0         // because 0 === -0, requires test by _equals()\n  || _equals( a, b ) // handles not strictly equal or zero values\n;\n\nfunction _equals( a, b ) {\n  // a and b have already failed test for strict equality or are zero\n  \n  var s, l, p, x, y;\n  \n  // They should have the same toString() signature\n  if ( ( s = toString.call( a ) ) !== toString.call( b ) ) return false;\n  \n  switch( s ) {\n    default: // Boolean, Date, String\n      return a.valueOf() === b.valueOf();\n    \n    case '[object Number]':\n      // Converts Number instances into primitive values\n      // This is required also for NaN test bellow\n      a = +a;\n      b = +b;\n      \n      return a ?         // a is Non-zero and Non-NaN\n          a === b\n        :                // a is 0, -0 or NaN\n          a === a ?      // a is 0 or -O\n          1/a === 1/b    // 1/0 !== 1/-0 because Infinity !== -Infinity\n        : b !== b        // NaN, the only Number not equal to itself!\n      ;\n    // [object Number]\n    \n    case '[object RegExp]':\n      return a.source   == b.source\n        && a.global     == b.global\n        && a.ignoreCase == b.ignoreCase\n        && a.multiline  == b.multiline\n        && a.lastIndex  == b.lastIndex\n      ;\n    // [object RegExp]\n    \n    case '[object Function]':\n      return false; // functions should be strictly equal because of closure context\n    // [object Function]\n    \n    case '[object Array]':\n      if ( cyclic && ( x = reference_equals( a, b ) ) !== null ) return x; // intentionally duplicated bellow for [object Object]\n      \n      if ( ( l = a.length ) != b.length ) return false;\n      // Both have as many elements\n      \n      while ( l-- ) {\n        if ( ( x = a[ l ] ) === ( y = b[ l ] ) && x !== 0 || _equals( x, y ) ) continue;\n        \n        return false;\n      }\n      \n      return true;\n    // [object Array]\n    \n    case '[object Object]':\n      if ( cyclic && ( x = reference_equals( a, b ) ) !== null ) return x; // intentionally duplicated from above for [object Array]\n      \n      l = 0; // counter of own properties\n      \n      if ( enforce_properties_order ) {\n        var properties = [];\n        \n        for ( p in a ) {\n          if ( a.hasOwnProperty( p ) ) {\n            properties.push( p );\n            \n            if ( ( x = a[ p ] ) === ( y = b[ p ] ) && x !== 0 || _equals( x, y ) ) continue;\n            \n            return false;\n          }\n        }\n        \n        // Check if 'b' has as the same properties as 'a' in the same order\n        for ( p in b )\n          if ( b.hasOwnProperty( p ) && properties[ l++ ] != p )\n            return false;\n      } else {\n        for ( p in a ) {\n          if ( a.hasOwnProperty( p ) ) {\n            ++l;\n            \n            if ( ( x = a[ p ] ) === ( y = b[ p ] ) && x !== 0 || _equals( x, y ) ) continue;\n            \n            return false;\n          }\n        }\n        \n        // Check if 'b' has as not more own properties than 'a'\n        for ( p in b )\n          if ( b.hasOwnProperty( p ) && --l < 0 )\n            return false;\n      }\n      \n      return true;\n    // [object Object]\n  } // switch toString.call( a )\n} // _equals()\n\n/* -----------------------------------------------------------------------------------------\n   reference_equals( a, b )\n   \n   Helper function to compare object references on cyclic objects or arrays.\n   \n   Returns:\n     - null if a or b is not part of a cycle, adding them to object_references array\n     - true: same cycle found for a and b\n     - false: different cycle found for a and b\n   \n   On the first call of a specific invocation of equal(), replaces self with inner function\n   holding object_references array object in closure context.\n   \n   This allows to create a context only if and when an invocation of equal() compares\n   objects or arrays.\n*/\nfunction reference_equals( a, b ) {\n  var object_references = [];\n  \n  return ( reference_equals = _reference_equals )( a, b );\n  \n  function _reference_equals( a, b ) {\n    var l = object_references.length;\n    \n    while ( l-- )\n      if ( object_references[ l-- ] === b )\n        return object_references[ l ] === a;\n    \n    object_references.push( a, b );\n    \n    return null;\n  } // _reference_equals()\n} // reference_equals()\n} // equals()\n\n\n\n\n// WEBPACK FOOTER //\n// ./rfexplore/value_equals.js","const TEXT_TYPE = 'text';\nconst BUTTON_TYPE = 'button';\n\nconst NO_ACTION = 'none';\nconst FUNC_ACTION = 'func';\nconst URL_ACTION = 'url';\nconst DROPDOWN_ACTION = 'dropdown';\n\nclass Menuitem {\n\n    constructor( { container, text = '', iconclass = '', type = 'text', action = 'none' } ) {\n        this.container = container;\n        this._text = text;\n        this._iconclass = iconclass;\n        this._type = type;\n        this._action = action;\n        this._callback = null;\n\n        this._liNode = null;\n        this._aNode = null;\n        this._textNode = null;\n        this._iconNode = null;\n\n        this._appendElem();\n    }\n\n    action( obj ) {\n        if( typeof obj === 'function' ) {\n            this._action = FUNC_ACTION;\n            this._callback = obj;\n            this._aNode.setAttribute( 'href', '#' );\n        } else if( typeof obj === 'string' ) {\n            this._action = URL_ACTION;\n            this._callback = null;\n            this._aNode.setAttribute( 'href', obj );\n        }\n        return this;\n    }\n\n    set text( t ) {\n        this._text = t;\n        this._textNode.nodeValue = t;\n    }\n\n    get text() { return this._text; }\n\n    set iconclass( c ) {\n        this._iconclass = c;\n        if( this._text != '' )\n            this._iconNode.className = `text-left ${c}`;\n        else\n            this._iconNode.className = `${c}`;\n    }\n\n    get iconclass() { return this._iconclass; }\n\n    _appendElem() {\n        this._liNode =document.createElement( 'li' );\n        this.container.appendChild( this._liNode );\n\n        switch( this._type ) {\n            case TEXT_TYPE:\n                this._aNode = document.createElement( 'a' );\n                this._liNode.appendChild( this._aNode );\n                break;\n            case BUTTON_TYPE:\n                this._aNode = document.createElement( 'a' );\n                this._aNode.className = 'button';\n                this._liNode.appendChild( this._aNode );\n                break;\n        }\n        this._textNode = document.createTextNode( this._text );\n        this._aNode.appendChild( this._textNode );\n        this._iconNode = document.createElement( 'i' );\n        this._aNode.appendChild( this._iconNode );\n        this.iconclass = this._iconclass;\n\n        this._aNode.addEventListener( 'click', ()=>{this._clicked();} );\n    }\n    _clicked() {\n        switch( this._action ) {\n            case NO_ACTION:\n                break;\n            case FUNC_ACTION:\n                if( typeof this._callback === 'function' )\n                    this._callback();\n                break;\n            case URL_ACTION:\n                break;\n            case DROPDOWN_ACTION:\n                // TODO\n                break;\n        }\n    }\n}\n\nexport default class Menubar {\n    constructor( container, { subgroup = false, parent = null, panel =false } = {} ) {\n        let parentContainer =container || document.body;\n        this._subgroup =subgroup;\n        this._parent = parent;\n\n        if( subgroup ) {\n            this.container = parentContainer;\n        } else {\n            this.container =document.createElement( 'div' );\n            this.container.className = \"menubar\";\n            parentContainer.appendChild( this.container );\n        }\n\n        if( !subgroup || subgroup && panel ) {\n            this._rootPanel =document.createElement( 'div' );\n            this._rootPanel.className = \"panel\";\n            this.container.appendChild( this._rootPanel );\n        } else {\n            this._rootPanel = parent._rootPanel;\n        }\n        \n        this._ulNode = document.createElement( 'ul' );\n        this._rootPanel.appendChild( this._ulNode );\n\n        this._items = new Array();\n        this._groups = new Array();\n    }\n\n    addGroup() {\n        let group = new Menubar( this.container, { subgroup: true, parent: this } );\n        this._groups.push( group );\n        return group;\n    }\n\n    addPanel() {\n        let group = new Menubar( this.container, { subgroup: true, parent: this, panel: true } );\n        this._groups.push( group );\n        return group;\n    }\n\n    addButton( text = '', iconclass = '' ) {\n        let item = new Menuitem( { container: this._ulNode, text: text, iconclass: iconclass, type: BUTTON_TYPE } );\n        this._items.push( item );\n        return item;\n    }\n\n    addLink( text = '', iconclass = '' ) {\n        let item = new Menuitem( { container: this._ulNode, text: text, iconclass: iconclass, type: TEXT_TYPE } );\n        this._items.push( item );\n        return item;\n    }\n\n    floatLeft() {\n        this._ulNode.className = 'float-left';\n        return this;\n    }\n    \n    floatRight() {\n        this._ulNode.className = 'float-right';\n        return this;\n    }\n    \n    floatCenter() {\n        this._ulNode.className = 'float-center';\n        return this;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rfexplore/menubar.js"],"sourceRoot":""}